{"version":3,"sources":["kee_frame/scroll.cljs"],"mappings":";AAMA,AAAA,AAACA,AACgB,AAAAC,AAAKG;AAAL,AAAA,AAAAF,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAASG;AAAT,AAAAF,AAAAD,AAAA,AAAA,AAAWI;AAAX,AAAAH,AAAAD,AAAA,AAAA,AAAiBK;AAAjB,AACMH,AACA,AAAA,AAAA,AAAA,AAACI,AAAiCF,AAClC,AAAA,AAAA,AAAA,AAACG,AAAqCF;;AAE7D,AAAA,AAAMG;AAAN,AACE,AAACC;;AAEH,AAAA,AAAMC,AAAmBN;AAAzB,AACE,AAACO,AAAqB,AAAA,AAAOP;;AAC7B,AAACQ,AAAMC,AACA,AAAKC;AAAL,AACE,AAACC,AAAK,AAAA,AAAAC,AAACC;AAAD,AAAS,AAAA,AAACC,AAAyB,AAAA,AAAAF;AAAWF,AAC9C,AAAAK,AAAA,AAAA,AAAA,AAAA,AACgC,AAAKE;AAAL,AACE,AAAA,AAAA,AAACC,AAAkClB,AAAMmB;;AACzCF;AAHlC,AAIgC,AAAKG;AAAL,AACE,AAAA,AAAA,AAACF,AAAkClB,AAAMqB;;AACzCD;;AANlC,AAAA,AAAAL,AAAAA,AAACC,AAAAA,AAAAA;;;;AAQlB,AAAA,AAACM,AACgB,AAAKvB,AAAEA;AAAP,AACE,AAACwB,AAAeC;;AADlB;;AAIjB,AAAA,AAACF,AACgB,AAAAG,AAAAC;AAAA,AAAA,AAAAC,AAAAF;AAAAE,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAAa7B;AAAbkC,AAAAN;AAAA,AAAA7B,AAAAmC,AAAA,AAAA,AAAmBjC;AAAnB,AAAAF,AAAAmC,AAAA,AAAA,AAAqBC;AAArB,AAAApC,AAAAmC,AAAA,AAAA,AAAkCE;AAAlC,AACE,AAAAC,AAA8B,AAAA,AAAgBrC;AAA9CqC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAP,AAAA,AAAAO,AAAA,AAAA,AAAA,AAAA,AAAAN,AAAAC,AAAAK,AAAAA;AAAA,AAAAJ,AAAAI,AAAA,AAAcnC;AAAd,AAAA+B,AAAAI,AAAA,AAAoBC;AAApB,AACE,AAAM,AAACC,AAAErC,AAAMiC;AAAf,AACE,AACE,AAAK,AAAA,AAAMG;AADb,AAAA,AAAA,AAAA;;AAAA,AAEE,AAAA,AAAMA;AAFR,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAGsDH,AAAa,AAAA,AAAKC;;AAHxE,AAIE,AAAA,AAAMA;AAJR,AAAA,AAIsB,AAAA,AAAA,AAACI,AAAMxC;;AAJ7B;;;;;AADF","names":["re_frame.core.reg_event_db","p__40008","vec__40009","cljs.core.nth","db","_","route","inc-or-dec","cljs.core/assoc-in","cljs.core.update_in","kee-frame.scroll/start!","clerk.core/initialize!","kee-frame.scroll/monitor-requests!","clerk.core/navigate-page!","cljs.core.swap_BANG_","ajax.core/default-interceptors","interceptors","cljs.core.conj","p1__40012#","cljs.core.filter","cljs.core.not_EQ_","G__40013","ajax.core/to-interceptor","request","re-frame.core/dispatch","cljs.core/inc","response","cljs.core/dec","re_frame.core.reg_event_fx","reagent.core/after-render","clerk.core/after-render!","p__40014","p__40015","map__40016","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","vec__40017","active-route","counter","map__40023","balance","cljs.core._EQ_","cljs.core.assoc"],"sourcesContent":["(ns ^:no-doc kee-frame.scroll\n  (:require [re-frame.core :as rf]\n            [ajax.core :as ajax]\n            [reagent.core :as r]\n            [clerk.core :as clerk]))\n\n(rf/reg-event-db ::connection-balance\n                 (fn [db [_ route inc-or-dec]]\n                   (-> db\n                       (assoc-in [:route-counter :route] route)\n                       (update-in  [:route-counter :balance] inc-or-dec))))\n\n(defn start! []\n  (clerk/initialize!))\n\n(defn monitor-requests! [route]\n  (clerk/navigate-page! (:path route))\n  (swap! ajax/default-interceptors\n         (fn [interceptors]\n           (conj (filter #(not= \"route-interceptor\" (:name %)) interceptors)\n                 (ajax/to-interceptor {:name     \"route-interceptor\"\n                                       :request  (fn [request]\n                                                   (rf/dispatch [::connection-balance route inc])\n                                                   request)\n                                       :response (fn [response]\n                                                   (rf/dispatch [::connection-balance route dec])\n                                                   response)})))))\n\n(rf/reg-event-fx ::scroll\n                 (fn [_ _]\n                   (r/after-render clerk/after-render!)\n                   nil))\n\n(rf/reg-event-fx ::poll\n                 (fn [{:keys [db]} [_ active-route counter]]\n                   (let [{:keys [route balance]} (:route-counter db)]\n                     (when (= route active-route)\n                       (cond\n                         (not (pos? balance)) {:dispatch [::scroll]}\n                         (pos? balance) {:dispatch-later [{:ms       50\n                                                           :dispatch [::poll active-route (inc counter)]}]}\n                         (< 20 counter) {:db (assoc db :route-counter nil)})))))\n\n"]}