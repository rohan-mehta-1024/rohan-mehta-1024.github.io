{"version":3,"sources":["re_chain/core.cljc"],"mappings":"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","names":["cljs.spec.alpha/def-impl","cljs.spec.alpha/cat-impl","cljs.spec.alpha/maybe-impl","cljs.core/vector?","cljs.core/fn?","cljs.spec.alpha/rep-impl","cljs.core/keyword?","cljs.spec.alpha/map-spec-impl","G__41518","cljs.core/map?","cljs.core/contains?","cljs.spec.alpha/nilable-impl","cljs.spec.alpha.every_impl","G__41519","cljs.core/coll?","re-chain.core/links","cljs.core.atom","re-chain.core/step-id","event-id","counter","cljs.core._EQ_","cljs.core.keyword","cljs.core/namespace","cljs.core/name","re-chain.core/replace-pointers","next-event","effects","clojure.walk/postwalk","x","re_frame.core.console","fexpr__41520","re-chain.core/single-valid-link","links","cljs.core/deref","cljs.core.filter","p__41521","map__41522","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","get-dispatch","effect-present?","and__4115__auto__","cljs.core/not","cljs.core/count","cljs.core/first","re-chain.core/dispatch-empty-or-next","next-event-id","event","cljs.core.assoc","re-chain.core/single-valid-next","xs","p__41524","map__41525","re-chain.core/select-link","or__4126__auto__","cljs.core.ex_info","p__41527","vec__41528","seq__41529","cljs.core/seq","first__41530","cljs.core/next","re-chain.core/make-event","previous-event-params","_","params","cljs.core.into","cljs.core.concat","re-chain.core/link-effects","event-params","temp__5733__auto__","map__41531","set-dispatch","G__41533","G__41534","re-chain.core/effect-postprocessor","ctx","cljs.core/rest","re_frame.core.get_coeffect","p1__41535#","cljs.core.update","re-chain.core/chain-interceptor","current-event-id","re_frame.core.__GT_interceptor","re-chain.core/collect-named-event-instructions","step-fns","chain-handlers","cljs.spec.alpha/conform","expound.alpha.expound","cljs.spec.alpha/explain-data","cljs.core.partition","cljs.core.map","p__41536","vec__41537","map__41540","cljs.core.nth","id","event-handler","handler-1","handler-2","next-id","re-chain.core/collect-event-instructions","key","cljs.core.map_indexed","p__41542","vec__41543","current-handler","next-handler","map__41546","fn","interceptors","re-chain.core/register-chain-handlers!","instructions","user-interceptors","seq__41550","chunk__41551","count__41552","i__41553","map__41564","temp__5735__auto__","cljs.core/chunked-seq?","c__4556__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","map__41573","interceptor","re_frame.core.reg_event_fx","var_args","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","re-chain.core/reg-chain-named*","seq41577","G__41578","self__4723__auto__","re-chain.core/reg-chain*","seq41590","G__41591","G__41592","re-chain.core/configure!","chain-links","cljs.core/reset!","re-chain.core/reg-chain-named","seq41605","self__4724__auto__","handlers","re-chain.core/reg-chain","seq41606","G__41607"],"sourcesContent":["(ns re-chain.core\n  (:require [clojure.walk :as walk]\n            [re-frame.core :as rf]\n            [clojure.spec.alpha :as s]\n            [expound.alpha :as e]))\n\n(s/def ::handler (s/cat :interceptors (s/? vector?) :fn fn?))\n(s/def ::handlers (s/* ::handler))\n(s/def ::named-handlers (s/* (s/cat :id keyword? :event-handler ::handler)))\n(s/def ::effect-present? fn?)\n(s/def ::get-dispatch fn?)\n(s/def ::set-dispatch fn?)\n(s/def ::link (s/keys :req-un [::effect-present? ::get-dispatch ::set-dispatch]))\n(s/def ::links (s/nilable (s/coll-of ::link)))\n\n(def links (atom []))\n\n(defn step-id [event-id counter]\n  (if (= 0 counter)\n    event-id\n    (keyword\n      (str (namespace event-id)\n           (if (namespace event-id) \"/\")\n           (name event-id)\n           \"-\" counter))))\n\n(defn replace-pointers [next-event effects]\n  (walk/postwalk\n    (fn [x]\n      (when (= x :kee-frame.core/next)\n        (rf/console :warn \"Keyword :kee-frame.core/next is deprecated, use :chain/next instead.\"))\n      (if (#{:kee-frame.core/next :chain/next} x)\n        next-event\n        x))\n    effects))\n\n(defn single-valid-link [effects]\n  (let [links (->> @links\n                   (filter (fn [{:keys [get-dispatch effect-present?]}]\n                             (and (effect-present? effects)\n                                  (not (get-dispatch effects))))))]\n    (when (= 1 (count links))\n      (first links))))\n\n(defn dispatch-empty-or-next [effects next-event-id]\n  (when (or (not (:dispatch effects))\n            (-> effects\n                :dispatch\n                first\n                (= next-event-id)))\n    {:get-dispatch :dispatch\n     :set-dispatch (fn [effects event] (assoc effects :dispatch event))}))\n\n(defn single-valid-next [next-event-id effects]\n  (let [xs (->> @links\n                (filter (fn [{:keys [get-dispatch]}]\n                          (= next-event-id\n                             (-> effects get-dispatch first)))))]\n    (when (= 1 (count xs))\n      (first xs))))\n\n(defn select-link [next-event-id effects]\n  (or\n    (single-valid-next next-event-id effects)\n    (single-valid-link effects)\n    (dispatch-empty-or-next effects next-event-id)\n    (throw\n      (ex-info \"Not possible to select next in chain\"\n               {:next-id  next-event-id\n                :dispatch (:dispatch effects)\n                :links    @links}))))\n\n(defn make-event [next-event-id previous-event-params [_ & params]]\n  (into [next-event-id] (concat previous-event-params params)))\n\n(defn link-effects [next-event-id event-params effects]\n  (if next-event-id\n    (if-let [{:keys [set-dispatch get-dispatch]} (select-link next-event-id effects)]\n      (set-dispatch effects (make-event next-event-id event-params (get-dispatch effects)))\n      effects)\n    effects))\n\n(defn effect-postprocessor [next-event-id]\n  (fn [ctx]\n    (let [event-params (rest (rf/get-coeffect ctx :event))]\n      (update ctx :effects #(->> %\n                                 (replace-pointers next-event-id)\n                                 (link-effects next-event-id event-params))))))\n\n(defn chain-interceptor [current-event-id next-event-id]\n  (rf/->interceptor\n    :id current-event-id\n    :after (effect-postprocessor next-event-id)))\n\n(defn collect-named-event-instructions [step-fns]\n  (let [chain-handlers (s/conform ::named-handlers step-fns)]\n    (when (= ::s/invalid chain-handlers)\n      (e/expound ::named-handlers step-fns)\n      (throw (ex-info \"Invalid named chain. Should be pairs of keyword and handler\" (s/explain-data ::named-handlers step-fns))))\n    (->> chain-handlers\n         (partition 2 1 [nil])\n         (map (fn [[{:keys [id event-handler] :as handler-1} handler-2]]\n                (let [next-id (:id handler-2)]\n                  (assoc handler-1 :next-id (:id handler-2)\n                                   :interceptors (:interceptors event-handler)\n                                   :event-handler (:fn event-handler)\n                                   :interceptor (chain-interceptor id next-id))))))))\n\n(defn collect-event-instructions [key step-fns]\n  (let [chain-handlers (s/conform ::handlers step-fns)]\n    (when (= ::s/invalid chain-handlers)\n      (e/expound ::handlers step-fns)\n      (throw (ex-info \"Invalid chain. Should be functions or pairs of interceptor and function\" (s/explain-data ::handlers step-fns))))\n    (->> chain-handlers\n         (partition 2 1 [nil])\n         (map-indexed (fn [counter [current-handler next-handler]]\n                        (let [{:keys [fn interceptors]} current-handler\n                              id (step-id key counter)\n                              next-id (when next-handler (step-id key (inc counter)))]\n                          {:id            id\n                           :next-id       next-id\n                           :event-handler fn\n                           :interceptors  interceptors\n                           :interceptor   (chain-interceptor id next-id)}))))))\n\n(defn register-chain-handlers! [instructions user-interceptors]\n  (doseq [{:keys [id event-handler interceptor interceptors]} instructions]\n    (rf/reg-event-fx id (into [interceptor] (concat user-interceptors interceptors)) event-handler)))\n\n(defn reg-chain-named*\n  \"Same as `reg-chain-named`, but with a vector of interceptors as the first parameter. The interceptors specified\n  will be appended to each event's interceptors.\"\n  [interceptors & step-fns]\n  (let [instructions (collect-named-event-instructions step-fns)]\n    (register-chain-handlers! instructions interceptors)))\n\n(defn reg-chain*\n  \"Same as `reg-chain`, but with a vector of interceptors as the second parameter. The interceptors specified\n  will be appended to each event's interceptors.\"\n  [id interceptors & step-fns]\n  (let [instructions (collect-event-instructions id step-fns)]\n    (register-chain-handlers! instructions interceptors)))\n\n(defn configure!\n  \"re-chain only supports the `dispatch` effect out of the box. To add more effects, call this function at the startup\n  of your app.\n\n  Parameters:\n\n  `chain-links`: Vector of maps. Each map describes how to chain together events using a certain effect. The map should\n  contain 3 keys:\n  - `:effect-present?` : Is the effect present in the effects map returned from an event function?\n  - `:get-dispatch` : Try to lookup the dispatch value from the effects map\n  - `:set-dispatch` : Set the dispatch value in the effects map\n\n  Usage:\n  ```\n  (chain/configure! [{:effect-present? (fn [effects] (:http-xhrio effects))\n                      :get-dispatch    (fn [effects] (get-in effects [:http-xhrio :on-success]))\n                      :set-dispatch    (fn [effects dispatch] (assoc-in effects [:http-xhrio :on-success] dispatch))}])\n  ```\n  \"\n  [chain-links]\n  (reset! links chain-links))\n\n(defn reg-chain-named\n  \"Same as `reg-chain`, but with manually named event handlers. Useful when you need more meaningful names in your\n  event log.\n\n  Parameters:\n\n  `handlers`: pairs of id and event handler.\n\n  Usage:\n  ```\n  (k/reg-chain-named\n\n    :load-customer-data\n    (fn [ctx [customer-id]]\n      {:http-xhrio {:uri \\\"...\\\"}})\n\n    :receive-customer-data\n     (fn [ctx [customer-id customer-data]]\n      (assoc-in ctx [:db :customers customer-id] customer-data)))\n  ```\"\n  [& handlers]\n  (apply reg-chain-named* nil handlers))\n\n(defn reg-chain\n  \"Register a list of re-frame fx handlers, chained together.\n\n  The chaining is done through dispatch inference. https://github.com/Day8/re-frame-http-fx is supported by default,\n  you can easily add your own like this: https://github.com/ingesolvoll/kee-frame#configuring-chains-since-020.\n\n  Each handler's event vector is prepended with accumulated event vectors of previous handlers. So if the first handler\n  receives [a b], and the second handler normally would receive [c], it will actually receive [a b c]. The purpose is\n  to make all context available to the entire chain, without a complex framework or crazy scope tricks.\n\n  Parameters:\n\n  `id`: the id of the first re-frame event. The next events in the chain will get the same id followed by an index, so\n  if your id is `add-todo`, the next one in chain will be called `add-todo-1`.\n\n  `handlers`: re-frame event handler functions, registered with `re-frame.core/reg-event-fx`.\n\n\n  Usage:\n  ```\n  (k/reg-chain\n    :load-customer-data\n\n    (fn {ctx [customer-id]]\n      {:http-xhrio {:uri    (str \\\"/customer/\\\" customer-id)\n                    :method :get}})\n\n    (fn [cxt [customer-id customer-data]\n      (assoc-in ctx [:db :customers customer-id] customer-data)))\n  ```\"\n  [id & handlers]\n  (apply reg-chain* id nil handlers))"]}